webpackJsonp([8],{"4rMD":function(e,t){},APmC:function(e,t){},IATx:function(e,t){},"a50/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("ZLEe"),a=n.n(o),i=n("lC5x"),r=n.n(i),s=n("J0Oq"),l=n.n(s),u=n("C/I2"),d=document.addEventListener?function(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}:function(e,t,n){e&&t&&n&&e.attachEvent("on"+t,n)},c=document.removeEventListener?function(e,t,n){e&&t&&e.removeEventListener(t,n,!1)}:function(e,t,n){e&&t&&e.detachEvent("on"+t,n)},f={name:"OrgView",props:{zoomHandled:{type:Number,default:1},data:Object,horizontal:Boolean,nodeRender:Function},data:function(){return{currentContextMenuId:"",orgTreeOffsetLeft:0,orgTreeOffsetTop:0,initPageX:0,initPageY:0,oldMarginLeft:0,oldMarginTop:0,canMove:!1}},computed:{orgTreeStyle:function(){return{transform:"translate(-50%, -50%) scale("+this.zoomHandled+", "+this.zoomHandled+")",marginLeft:this.orgTreeOffsetLeft+"px",marginTop:this.orgTreeOffsetTop+"px"}}},methods:{handleNodeClick:function(e,t,n){console.log(e,t)},onExpand:function(e){"expand"in e?(e.expand=!e.expand,!e.expand&&e.children&&this.collapse(e.children)):this.$set(e,"expand",!0)},collapse:function(e){var t=this;e.forEach(function(e){e.expand&&(e.expand=!1),e.children&&t.collapse(e.children)})},getBgColor:function(e){return"#5d6c7b"},contextmenu:function(e,t){var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1,this.currentContextMenuId=e.id},mousedownView:function(e){this.canMove=!0,this.initPageX=e.pageX,this.initPageY=e.pageY,this.oldMarginLeft=this.orgTreeOffsetLeft,this.oldMarginTop=this.orgTreeOffsetTop,d(document,"mousemove",this.mousemoveView),d(document,"mouseup",this.mouseupView)},handleDocumentContextmenu:function(){this.canMove=!1},mousemoveView:function(e){if(this.canMove){var t=e.pageX,n=e.pageY;this.orgTreeOffsetLeft=this.oldMarginLeft+t-this.initPageX,this.orgTreeOffsetTop=this.oldMarginTop+n-this.initPageY}},mouseupView:function(){this.canMove=!1,c(document,"mousemove",this.mousemoveView),c(document,"mouseup",this.mouseupView)}}},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"dragWrapper",staticClass:"org-tree-drag-wrapper",on:{mousedown:e.mousedownView,contextmenu:e.handleDocumentContextmenu}},[n("div",{staticClass:"org-tree-wrapper",style:e.orgTreeStyle},[e.data?n("v-org-tree",{attrs:{data:e.data,"node-render":e.nodeRender,horizontal:e.horizontal,"expand-all":!0,collapsable:""},on:{"on-node-click":e.handleNodeClick}}):e._e()],1)])},staticRenderFns:[]};var m=n("C7Lr")(f,p,!1,function(e){n("ed1f")},null,null).exports,h={name:"ZoomController",props:{value:{type:Number,default:100},step:{type:Number,default:20},min:{type:Number,default:10},max:{type:Number,default:200}},methods:{scale:function(e){var t=this.value+("down"===e?-this.step:this.step);t<this.min&&"down"===e||t>this.max&&"up"===e||this.$emit("input",t)}}},v={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"zoom-wrapper"},[n("button",{staticClass:"zoom-button",on:{click:function(t){return e.scale("down")}}},[n("svg-icon",{staticStyle:{color:"#fff","font-size":"12px",position:"relative",right:"2px"},attrs:{"icon-class":"minus"}})],1),e._v(" "),n("span",{staticClass:"zoom-number"},[e._v(e._s(e.value)+"%")]),e._v(" "),n("button",{staticClass:"zoom-button",on:{click:function(t){return e.scale("up")}}},[n("svg-icon",{staticStyle:{color:"#fff","font-size":"12px",position:"relative",right:"2px"},attrs:{"icon-class":"plus"}})],1)])},staticRenderFns:[]};var g=n("C7Lr")(h,v,!1,function(e){n("APmC")},null,null).exports,x={data:function(){return{currentContextMenuId:""}},methods:{contextmenu:function(e,t){var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1,this.currentContextMenuId=e.id},onExpand:function(e){"expand"in e?(e.expand=!e.expand,!e.expand&&e.children&&this.collapse(e.children)):this.$set(e,"expand",!0)},collapse:function(e){var t=this;e.forEach(function(e){e.expand&&(e.expand=!1),e.children&&t.collapse(e.children)})}}},w=(n("IATx"),n("vLgD"));var _={name:"index",components:{PanelTitle:u.a,OrgView:m,ZoomController:g},mixins:[x],data:function(){return{data:null,all_data:[],root_users:[],uid:null,zoom:100,horizontal:!1,webs:[]}},computed:{zoomHandled:function(){return this.zoom/100}},created:function(){this.getUserRelation()},methods:{getUserRelation:function(){var e=this;return l()(r.a.mark(function t(){var n,o,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(w.a)({url:"/relation/user",method:"get"});case 2:n=t.sent,o=n.data,e.all_data=o,e.root_users=n.root_users,e.uid=e.root_users[0].id,a=o.filter(function(t){return t.id===e.uid}),e.data=a.length?a[0]:null;case 9:case"end":return t.stop()}},t,e)}))()},nodeRender:function(e,t){if(!a()(t).length)return!1;return e("div",{domProps:{className:["custom-org-node"].join(" ")},on:{mousedown:function(e){return e.stopPropagation()},contextmenu:this.contextmenu.bind(this,t),click:this.onExpand.bind(this,t)}},[e("div",t.label),e("div",{style:{fontSize:"12px"}},t.type)])},changeRootUser:function(e){var t=this.all_data.filter(function(t){return t.id===e});this.data=t.length?t[0]:null}}},C={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("panel-title",{attrs:{title:"用户关系图","is-line":""}}),e._v(" "),n("el-row",[n("el-col",{attrs:{span:24}},[n("div",[n("span",{staticClass:"span-color"},[e._v("最上级用户：")]),e._v(" "),e.root_users.length?n("el-radio-group",{on:{change:e.changeRootUser},model:{value:e.uid,callback:function(t){e.uid=t},expression:"uid"}},e._l(e.root_users,function(t){return n("el-radio-button",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.label)+"\n          ")])}),1):e._e()],1)])],1),e._v(" "),n("el-row",[n("el-col",{staticStyle:{height:"700px"},attrs:{span:12}},[n("div",{staticClass:"department-outer"},[n("div",{staticClass:"zoom-box"},[n("zoom-controller",{attrs:{min:20,max:200},model:{value:e.zoom,callback:function(t){e.zoom=t},expression:"zoom"}})],1),e._v(" "),n("div",{staticClass:"view-box"},[e.data?n("org-view",{attrs:{data:e.data,horizontal:e.horizontal,"zoom-handled":e.zoomHandled,"node-render":e.nodeRender}}):e._e()],1)])])],1)],1)},staticRenderFns:[]};var b=n("C7Lr")(_,C,!1,function(e){n("4rMD")},"data-v-11e9d585",null);t.default=b.exports},ed1f:function(e,t){}});