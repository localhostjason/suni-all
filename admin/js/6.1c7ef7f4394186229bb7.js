webpackJsonp([6],{"28yx":function(e,t){},"4AdS":function(e,t){},DznN:function(e,t){},TIO6:function(e,t){},j98B:function(e,t,r){"use strict";var a=r("lC5x"),s=r.n(a),i=r("J0Oq"),l=r.n(i),n=r("Dvzh"),o=r("ZLEe"),d=r.n(o),u=r("HA9O"),c=r("cAgV"),f=r("Q0Ca"),p=r("psq8"),m=r.n(p),v={name:"AddressTable",directives:{waves:c.a},filters:{dateFormat:f.dateFormat},data:function(){return{dialog:{visible:!1},user_id:null,activeValue:!0,addressList:[],listLoading:!0,id:null,addressId:null,form:{recipient_name:null,recipient_phone:null,province:null,city:null,area:null,address:null,is_default:!1},formRules:{recipient_name:[{required:!0,message:"请输入收件人",trigger:"blur"}],recipient_phone:[{required:!0,message:"请输入收件电话",trigger:"blur"}],province:[{required:!0,message:"请输入省",trigger:"blur"}],city:[{required:!0,message:"请输入城市",trigger:"blur"}],area:[{required:!0,message:"请输入区/镇",trigger:"blur"}],address:[{required:!0,message:"请输详细地址",trigger:"blur"}]}}},methods:{init_data:function(e,t){var r=this;this.$nextTick(function(){r.addressId=t,r.user_id=e,r.getAddressList()})},editAddress:function(e){var t=this;this.dialog.visible=!0,this.$nextTick(function(){t.$refs.form.clearValidate(),t.form=m.a.pick(e,d()(t.form)),t.id=e.id})},getAddressList:function(){var e=this;Object(u.c)({user:this.user_id},{user:!0},"-is_default,-time").then(function(t){e.addressList=t._items.map(function(t){return e.$set(t,"visible",!1),t}),e.listLoading=!1})},updateAddressInfo:function(){var e,t=this;this.$refs.form.validate((e=l()(s.a.mark(function e(r){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,Object(u.d)(t.id,t.form);case 4:t.dialog.visible=!1,t.getAddressList(),t.$message.success("更新成功"),t.$emit("getOrderList");case 8:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},changeAddress:function(e){this.addressId=e?e.id:null,this.$emit("setAddressId",this.addressId)}}},g={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-dialog",{attrs:{title:"收件地址",visible:e.dialog.visible,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[r("el-row",{staticStyle:{"margin-bottom":"20px","margin-top":"-8px"}},[r("div",{staticClass:"div_title"},[r("span",[e._v("地址信息")])])]),e._v(" "),r("el-row",[r("el-col",{attrs:{span:18}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules,"label-width":"180px"}},[r("el-form-item",{attrs:{label:"用户ID:"}},[r("span",[e._v(e._s(e.user_id))])]),e._v(" "),r("el-form-item",{attrs:{label:"收件人:",prop:"recipient_name"}},[r("el-input",{attrs:{placeholder:"请输入收件人"},model:{value:e.form.recipient_name,callback:function(t){e.$set(e.form,"recipient_name",t)},expression:"form.recipient_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"收件电话:",prop:"recipient_phone"}},[r("el-input",{attrs:{placeholder:"请输入收件电话"},model:{value:e.form.recipient_phone,callback:function(t){e.$set(e.form,"recipient_phone",t)},expression:"form.recipient_phone"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"省份:",prop:"province"}},[r("el-input",{attrs:{placeholder:"请输入省"},model:{value:e.form.province,callback:function(t){e.$set(e.form,"province",t)},expression:"form.province"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"城市:",prop:"city"}},[r("el-input",{attrs:{placeholder:"请输入城市额"},model:{value:e.form.city,callback:function(t){e.$set(e.form,"city",t)},expression:"form.city"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"区/镇:",prop:"area"}},[r("el-input",{attrs:{placeholder:"请输入区/镇"},model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"详细地址:",prop:"address"}},[r("el-input",{attrs:{placeholder:"请输入详细地址"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"默认:",prop:"is_default"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":e.activeValue,"inactive-value":!e.activeValue},model:{value:e.form.is_default,callback:function(t){e.$set(e.form,"is_default",t)},expression:"form.is_default"}})],1),e._v(" "),r("el-form-item",[r("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.updateAddressInfo}},[e._v("确 定")])],1)],1)],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"table",attrs:{data:e.addressList,border:"",fit:""},on:{"current-change":e.changeAddress}},[r("el-table-column",{attrs:{width:"50",label:"#",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-radio",{staticClass:"radio",attrs:{label:t.row.id},model:{value:e.addressId,callback:function(t){e.addressId=t},expression:"addressId"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left"}},[r("el-form-item",{attrs:{label:"收件人"}},[r("span",[e._v(e._s(t.row.recipient_name))])]),e._v(" "),r("el-form-item",{attrs:{label:"收件电话"}},[r("span",[e._v(e._s(t.row.recipient_phone))])]),e._v(" "),r("el-form-item",{attrs:{label:"默认"}},[r("span",[e._v(e._s(t.row.is_default?"✔":"✘"))])])],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"province",label:"省份",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{prop:"city",label:"城市",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{prop:"area",label:"区/镇",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{prop:"address",label:"详细地址"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",align:"right",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.editAddress(t.row)}}},[e._v("编辑")])]}}])})],1)],1)],1)],1)},staticRenderFns:[]};var _={name:"OrderDialog",components:{AddressTable:r("C7Lr")(v,g,!1,function(e){r("28yx")},null,null).exports},data:function(){return{dialog:{title:null,visible:!1},order_id:null,address:null,real_name:null,phone:null}},methods:{showOrderDialog:function(e){var t=this;this.dialog.visible=!0,this.dialog.title="修改订单【"+e.id+"】",this.$nextTick(function(){t.$refs.form.clearValidate(),t.order_id=e.id,t.real_name=e.user.real_name,t.phone=e.user.phone,t.$refs.address.init_data(e.user.id,e.address)})},updateOrderInfo:function(){var e=this;return l()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={address:e.address},t.next=3,Object(n.f)(e.order_id,r);case 3:e.$message.success("更新成功"),e.dialog.visible=!1,e.$emit("getOrderList");case 6:case"end":return t.stop()}},t,e)}))()},toGetOrderList:function(){this.$emit("getOrderList")},setAddressId:function(e){this.address=e}}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,"close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[r("el-row",{staticStyle:{"margin-bottom":"20px","margin-top":"-8px"}},[r("div",{staticClass:"div_title"},[r("span",[e._v("订单信息")])])]),e._v(" "),r("el-row",[r("el-col",{attrs:{span:21}},[r("el-form",{ref:"form",attrs:{"label-width":"120px"}},[r("el-form-item",{attrs:{label:"姓名:"}},[e._v("\n          "+e._s(e.real_name)+"\n        ")]),e._v(" "),r("el-form-item",{attrs:{label:"手机号:"}},[r("span",[e._v(e._s(e.phone))])]),e._v(" "),r("el-form-item",{attrs:{label:"收件地址:"}},[r("address-table",{ref:"address",on:{getOrderList:e.toGetOrderList,setAddressId:e.setAddressId}})],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.updateOrderInfo}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var h=r("C7Lr")(_,b,!1,function(e){r("4AdS")},"data-v-4f5dde00",null);t.a=h.exports},sz9h:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("4YfN"),s=r.n(a),i=r("C/I2"),l=r("Dvzh"),n=r("j98B"),o=r("ZLEe"),d=r.n(o),u=r("2bvH"),c={name:"ReplyDialog",computed:s()({},Object(u.b)(["username"])),data:function(){return{dialog:{title:null,visible:!1},user:null,order_id:null,form:{desc:null,order:null,from_user:!1},refunds:[],formRules:{desc:[{required:!0,message:"请输入回复",trigger:"blur"}]}}},methods:{showRefundDialog:function(e){var t=this;this.dialog.visible=!0,this.dialog.title="回复【"+e.id+"】订单申请",this.getRefundList(),this.$nextTick(function(){t.$refs.form.clearValidate(),t.form=_.pick(e,d()(t.form)),t.form.order=e.id,t.form.from_user=!1,t.order_id=e.id,t.user=(e.user.real_name||"--")+"/"+e.user.phone})},updateOrderRefund:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;Object(l.b)(e.form).then(function(){e.$message.success("回复成功"),e.dialog.visible=!1,e.$emit("getOrderList")})})},getRefundList:function(){var e=this,t={order:this.order_id};Object(l.e)(t).then(function(t){e.refunds=t._items})}}},f={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"40%","close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[r("el-row",{staticStyle:{"margin-bottom":"20px","margin-top":"-8px"}},[r("div",{staticClass:"div_title"},[r("span",[e._v("退款申请信息")])])]),e._v(" "),r("el-row",[r("el-col",{attrs:{span:18}},e._l(e.refunds,function(t){return r("div",[r("div",{staticClass:"pull-left",staticStyle:{width:"100px","text-align":"right"}},[t.from_user?r("span",{staticClass:"span-color"},[e._v(e._s(e.user)+"：")]):r("span",{staticClass:"span-color"},[e._v("管理员："+e._s(e.username)+"：")])]),e._v(" "),r("div",{staticClass:"pull-left",staticStyle:{padding:"0 20px 20px 20px",width:"80%"}},[e._v("\n          "+e._s(t.desc)+"\n        ")]),e._v(" "),r("div",{staticClass:"top-line",staticStyle:{width:"100%",float:"left"}})])}),0)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:18}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"回复:",prop:"desc"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:5}},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.updateOrderRefund}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var p=r("C7Lr")(c,f,!1,function(e){r("DznN")},"data-v-20e97f9e",null).exports,m={name:"OrderTable",components:{OrderDialog:n.a,ReplyDialog:p},props:{data:{type:Array,required:!0},total:null,pageQuery:{type:Object,required:!0},listLoading:{type:Boolean,required:!0,default:!0}},data:function(){return{}},methods:{handleSizeChange:function(e){this.pageQuery.max_results=e,this.$emit("getOrderList")},handleCurrentChange:function(e){this.pageQuery.page=e,this.$emit("getOrderList")},otGetOrderList:function(){this.$emit("getOrderList")},agreeRefund:function(e){var t=this;Object(l.f)(e.id,{status:"refunded"}).then(function(e){t.$message.success("退款完成"),t.$emit("getOrderList")})},refuseRefund:function(e){var t=this;Object(l.f)(e.id,{status:e.old_status}).then(function(e){t.$message.success("拒绝成功"),t.$emit("getOrderList")})},reRefundDialog:function(e){this.$refs.replyDialog.showRefundDialog(e)},updateOrderInfo:function(e){var t=this;this.$confirm("此操作将删除订单, 是否继续?","提示",{type:"warning"}).then(function(){t.loading=!0,Object(l.f)(e.id,{is_deleted:!0}).then(function(){t.$emit("getOrderList"),t.loading=!1,t.$message.success("删除成功")})}).catch(function(){return console.log("no deleted")})},editOrderDialog:function(e){this.$refs.orderDialog.showOrderDialog(e)}}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.data,border:"",fit:""}},[r("el-table-column",{attrs:{prop:"id",label:"订单ID",width:"80"}}),e._v(" "),r("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"150"}}),e._v(" "),r("el-table-column",{attrs:{label:"退款申请描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"span-color"},[e._v(e._s(t.row.refund.length))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"amount",label:"总金额",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{prop:"number",label:"总数量",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{label:"用户/手机号",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.user.real_name||"--"))]),e._v(" "),r("div",{staticClass:"span-color"},[e._v(e._s(t.row.user.phone))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"commodity",label:"商品信息"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",fixed:"right",align:"right",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.editOrderDialog(t.row)}}},[e._v("编辑")]),e._v(" "),"refunded"===t.row.status?r("span",{staticClass:"text-explode"},[e._v("|")]):e._e(),e._v(" "),"refunded"===t.row.status?r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.updateOrderInfo(t.row)}}},[e._v("删除")]):e._e()],1),e._v(" "),"refunded"!==t.row.status?r("div",[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.reRefundDialog(t.row)}}},[e._v("回复申请")]),e._v(" "),r("span",{staticClass:"text-explode"},[e._v("|")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.agreeRefund(t.row)}}},[e._v("同意")]),e._v(" "),r("span",{staticClass:"text-explode"},[e._v("|")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.refuseRefund(t.row)}}},[e._v("拒绝")])],1):e._e()]}}])})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-pagination",{attrs:{"current-page":e.pageQuery.page,"page-sizes":[10,20,30,40],"page-size":e.pageQuery.max_results,total:e.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),r("order-dialog",{ref:"orderDialog",on:{getOrderList:e.otGetOrderList}}),e._v(" "),r("reply-dialog",{ref:"replyDialog",on:{getOrderList:e.otGetOrderList}})],1)},staticRenderFns:[]},g=r("C7Lr")(m,v,!1,null,null,null).exports,b=r("cAgV"),h=r("0xDb"),y={name:"OrderTableFilter",directives:{waves:b.a},props:{status:{type:String,required:!0}},data:function(){return{pickerOptions:h.f,argsQuery:{create_time:""}}},watch:{status:function(){this.argsQuery=Object(h.g)(this.argsQuery)}},methods:{handleFilter:function(){this.argsQuery.status=this.status,this.$emit("filterOrder",this.argsQuery)}}},x={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",[r("el-col",{attrs:{span:24}},[r("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":e.pickerOptions},model:{value:e.argsQuery.create_time,callback:function(t){e.$set(e.argsQuery,"create_time",t)},expression:"argsQuery.create_time"}}),e._v(" "),r("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v("查 询")])],1)],1)},staticRenderFns:[]},w=r("C7Lr")(y,x,!1,null,null,null).exports,O={name:"index",components:{PanelTitle:i.a,RefundTable:g,RefundTableFilter:w},data:function(){return{orderType:[{value:"is_refund",label:"退款申请"},{value:"refunded",label:"退款完成"}],listLoading:!0,dataList:[],total:0,listQuery:{argsQuery:{},pageQuery:{page:1,max_results:10}},status:this.$route.query.status||"is_refund"}},created:function(){this.getOrderList()},methods:{handleClickTab:function(e){this.status=e.name,this.listQuery.argsQuery={},this.listQuery.pageQuery={page:1,max_results:10},this.getOrderList()},filterOrder:function(e){this.listQuery.pageQuery.page=1,this.listQuery.argsQuery=e,this.getOrderList()},getOrderList:function(){var e=this,t=s()({},this.listQuery);t.argsQuery=Object(h.h)(t.argsQuery,"create_time"),t.argsQuery.status=this.status,t.argsQuery.is_deleted=!1;Object(l.d)(t,{user:!0,record:!0}).then(function(t){e.dataList=t._items,e.total=t._meta.total,e.listLoading=!1})}}},L={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("panel-title",{attrs:{title:"订单信息","is-line":""}}),e._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClickTab},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.orderType,function(t){return r("el-tab-pane",{key:t.value,attrs:{label:t.label,name:t.value}},[r("refund-table-filter",{attrs:{status:e.status},on:{filterOrder:e.filterOrder}}),e._v(" "),r("refund-table",{attrs:{data:e.dataList,"page-query":e.listQuery.pageQuery,total:e.total,"list-loading":e.listLoading},on:{getOrderList:e.getOrderList}})],1)}),1)],1)],1)],1)},staticRenderFns:[]};var k=r("C7Lr")(O,L,!1,function(e){r("TIO6")},"data-v-08084b75",null);t.default=k.exports}});