webpackJsonp([8],{APmC:function(e,t){},IATx:function(e,t){},"a50/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("ZLEe"),i=n.n(o),r=n("lC5x"),a=n.n(r),s=n("J0Oq"),l=n.n(s),u=n("C/I2"),c=document.addEventListener?function(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}:function(e,t,n){e&&t&&n&&e.attachEvent("on"+t,n)},d=document.removeEventListener?function(e,t,n){e&&t&&e.removeEventListener(t,n,!1)}:function(e,t,n){e&&t&&e.detachEvent("on"+t,n)},f={name:"OrgView",props:{zoomHandled:{type:Number,default:1},data:Object,horizontal:Boolean,nodeRender:Function},data:function(){return{currentContextMenuId:"",orgTreeOffsetLeft:0,orgTreeOffsetTop:0,initPageX:0,initPageY:0,oldMarginLeft:0,oldMarginTop:0,canMove:!1}},computed:{orgTreeStyle:function(){return{transform:"translate(-50%, -50%) scale("+this.zoomHandled+", "+this.zoomHandled+")",marginLeft:this.orgTreeOffsetLeft+"px",marginTop:this.orgTreeOffsetTop+"px"}}},methods:{handleNodeClick:function(e,t,n){console.log(e,t)},onExpand:function(e){"expand"in e?(e.expand=!e.expand,!e.expand&&e.children&&this.collapse(e.children)):this.$set(e,"expand",!0)},collapse:function(e){var t=this;e.forEach(function(e){e.expand&&(e.expand=!1),e.children&&t.collapse(e.children)})},getBgColor:function(e){return"#5d6c7b"},contextmenu:function(e,t){var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1,this.currentContextMenuId=e.id},mousedownView:function(e){this.canMove=!0,this.initPageX=e.pageX,this.initPageY=e.pageY,this.oldMarginLeft=this.orgTreeOffsetLeft,this.oldMarginTop=this.orgTreeOffsetTop,c(document,"mousemove",this.mousemoveView),c(document,"mouseup",this.mouseupView)},handleDocumentContextmenu:function(){this.canMove=!1},mousemoveView:function(e){if(this.canMove){var t=e.pageX,n=e.pageY;this.orgTreeOffsetLeft=this.oldMarginLeft+t-this.initPageX,this.orgTreeOffsetTop=this.oldMarginTop+n-this.initPageY}},mouseupView:function(){this.canMove=!1,d(document,"mousemove",this.mousemoveView),d(document,"mouseup",this.mouseupView)}}},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"dragWrapper",staticClass:"org-tree-drag-wrapper",on:{mousedown:e.mousedownView,contextmenu:e.handleDocumentContextmenu}},[n("div",{staticClass:"org-tree-wrapper",style:e.orgTreeStyle},[e.data?n("v-org-tree",{attrs:{data:e.data,"node-render":e.nodeRender,horizontal:e.horizontal,"expand-all":!0,collapsable:""},on:{"on-node-click":e.handleNodeClick}}):e._e()],1)])},staticRenderFns:[]};var h=n("C7Lr")(f,p,!1,function(e){n("ed1f")},null,null).exports,m={name:"ZoomController",props:{value:{type:Number,default:100},step:{type:Number,default:20},min:{type:Number,default:10},max:{type:Number,default:200}},methods:{scale:function(e){var t=this.value+("down"===e?-this.step:this.step);t<this.min&&"down"===e||t>this.max&&"up"===e||this.$emit("input",t)}}},v={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"zoom-wrapper"},[n("button",{staticClass:"zoom-button",on:{click:function(t){return e.scale("down")}}},[n("svg-icon",{staticStyle:{color:"#fff","font-size":"12px",position:"relative",right:"2px"},attrs:{"icon-class":"minus"}})],1),e._v(" "),n("span",{staticClass:"zoom-number"},[e._v(e._s(e.value)+"%")]),e._v(" "),n("button",{staticClass:"zoom-button",on:{click:function(t){return e.scale("up")}}},[n("svg-icon",{staticStyle:{color:"#fff","font-size":"12px",position:"relative",right:"2px"},attrs:{"icon-class":"plus"}})],1)])},staticRenderFns:[]};var g=n("C7Lr")(m,v,!1,function(e){n("APmC")},null,null).exports,_={data:function(){return{currentContextMenuId:""}},methods:{contextmenu:function(e,t){var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1,this.currentContextMenuId=e.id},onExpand:function(e){"expand"in e?(e.expand=!e.expand,!e.expand&&e.children&&this.collapse(e.children)):this.$set(e,"expand",!0)},collapse:function(e){var t=this;e.forEach(function(e){e.expand&&(e.expand=!1),e.children&&t.collapse(e.children)})}}},x=(n("IATx"),n("vLgD"));function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(x.a)({url:"/relation/user?phone="+e,method:"get"})}var w={name:"index",components:{PanelTitle:u.a,OrgView:h,ZoomController:g},mixins:[_],data:function(){return{loading:!1,show_filter:!0,filter_phone:"",c_filter_phone:"",data:null,all_data:[],root_users:[],uid:null,belong_user:null,zoom:100,horizontal:!1}},computed:{zoomHandled:function(){return this.zoom/100}},created:function(){this.getUserRelation()},methods:{getUserRelation:function(){var e=this;return l()(a.a.mark(function t(){var n,o,i,r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,b(e.filter_phone);case 3:n=t.sent,o=n.data,i=n.belong_user,e.all_data=o,e.belong_user=i,e.root_users=n.root_users,e.uid=e.root_users[0].id,i&&(e.uid=i),r=o.filter(function(t){return t.id===e.uid}),e.data=r.length?r[0]:null,!i&&e.filter_phone&&(e.data=null),e.loading=!1;case 15:case"end":return t.stop()}},t,e)}))()},selectUsers:function(){this.filter_phone||(this.uid=this.root_users[0].id),this.show_filter=!(!this.belong_user&&this.filter_phone),this.c_filter_phone=this.filter_phone,this.getUserRelation()},nodeRender:function(e,t){if(!i()(t).length)return!1;return e("div",{domProps:{className:["custom-org-node"].join(" ")},style:{color:this.c_filter_phone===t.label?"#333 !important":"#fff !important",background:this.c_filter_phone===t.label?"#fff !important":""},on:{mousedown:function(e){return e.stopPropagation()},contextmenu:this.contextmenu.bind(this,t),click:this.onExpand.bind(this,t)}},[e("div",t.label),e("div",{style:{fontSize:"12px"}},t.type)])},changeRootUser:function(e){var t=this.all_data.filter(function(t){return t.id===e});this.data=t.length?t[0]:null}}},C={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("panel-title",{attrs:{title:"用户关系图","is-line":""}}),e._v(" "),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"电话",clearable:""},model:{value:e.filter_phone,callback:function(t){e.filter_phone=t},expression:"filter_phone"}}),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.selectUsers}},[n("i",{staticClass:"el-icon-search"}),e._v(" "),n("span",[e._v("查 询")])])],1)],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:24}},[e.show_filter?n("div",[n("span",{staticClass:"text-gray-ol",staticStyle:{"font-size":"12px"}},[e._v("最上级用户：")]),e._v(" "),e.root_users.length?n("el-radio-group",{on:{change:e.changeRootUser},model:{value:e.uid,callback:function(t){e.uid=t},expression:"uid"}},e._l(e.root_users,function(t){return n("el-radio-button",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.label)+"\n          ")])}),1):e._e()],1):e._e()])],1),e._v(" "),n("el-row",[n("el-col",{staticStyle:{height:"700px"},attrs:{span:12}},[n("div",{staticClass:"department-outer"},[n("div",{staticClass:"zoom-box"},[n("zoom-controller",{attrs:{min:20,max:200},model:{value:e.zoom,callback:function(t){e.zoom=t},expression:"zoom"}})],1),e._v(" "),n("div",{staticClass:"view-box"},[e.data?n("org-view",{attrs:{data:e.data,horizontal:e.horizontal,"zoom-handled":e.zoomHandled,"node-render":e.nodeRender}}):e._e()],1)])])],1)],1)},staticRenderFns:[]};var z=n("C7Lr")(w,C,!1,function(e){n("mb86")},"data-v-41776291",null);t.default=z.exports},ed1f:function(e,t){},mb86:function(e,t){}});